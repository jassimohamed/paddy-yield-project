import pandas as pd
from sklearn.preprocessing import LabelEncoder, StandardScaler
from sklearn.model_selection import train_test_split
from sklearn.neighbors import KNeighborsRegressor

# Re-do Feature and Target Selection from the cleaned df
X = df.drop('Yield_Extent', axis=1)
y = df['Yield_Extent']

# Re-do Encoding Categorical Data
le = LabelEncoder()
for col in ['District', 'Season']:
    X[col] = le.fit_transform(X[col])

# Re-do Feature Scaling
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# Re-do Train Test Split
X_train, X_test, y_train, y_test = train_test_split(
    X_scaled, y, test_size=0.2, random_state=42
)

# Train the K-Nearest Neighbors Model (original problematic cell)
print("Starting K-Nearest Neighbors model training...")
knn_model.fit(X_train, y_train)
print("K-Nearest Neighbors model training completed.")

y_pred_knn = knn_model.predict(X_test)
print("Predictions made on X_test and stored in y_pred_knn.")

from sklearn.metrics import r2_score, mean_absolute_error, mean_squared_error

# Evaluate K-Nearest Neighbors Model Performance
r2_knn = r2_score(y_test, y_pred_knn)
mae_knn = mean_absolute_error(y_test, y_pred_knn)
mse_knn = mean_squared_error(y_test, y_pred_knn)
rmse_knn = mse_knn**0.5

# Print K-Nearest Neighbors Evaluation Results
print(f"\nK-Nearest Neighbors Model Performance:")
print(f"R-squared: {r2_knn:.4f}")
print(f"Mean Absolute Error (MAE): {mae_knn:.2f}")
print(f"Mean Squared Error (MSE): {mse_knn:.2f}")
print(f"Root Mean Squared Error (RMSE): {rmse_knn:.2f}")
